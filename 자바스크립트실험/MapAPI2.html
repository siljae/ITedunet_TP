<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>마커 표시하기</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=y4eqwdh098"></script>
    <style type="text/css">
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      // 클라이언트 ID와 시크릿 코드를 포함한 네이버 로그인 인증 정보를 설정합니다.
      const CLIENT_ID = "y4eqwdh098";
      const mapOptions = {
        center: new naver.maps.LatLng(35.2245195, 128.5795303),
        zoom: 10,
      };
      // 네이버지도를 생성합니다.
      const map = new naver.maps.Map("map", mapOptions);

      // 현재 위치를 받아오는 함수입니다.
      function getCurrentLocation(callback) {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              const lat = position.coords.latitude;
              const lng = position.coords.longitude;
              const latlng = new naver.maps.LatLng(lat, lng);
              callback(latlng);
            },
            function (error) {
              console.error(error);
            }
          );
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      // 동물병원 데이터를 가져와 지도에 마커로 표시하는 함수입니다.
      function getAnimalHospitalData(location) {
        const url = `https://naveropenapi.apigw.ntruss.com/map-place/v1/search?query=%EB%8F%99%EB%AC%BC%EB%B3%91%EC%9B%90&coordinate=${location.lng()},${location.lat()}&sort=distance`;
        const options = {
          headers: {
            "X-NCP-APIGW-API-KEY-ID": "y4eqwdh098",
            "X-NCP-APIGW-API-KEY": "c94O1tvURoa1A9Zrc0ZOsOlZQf5sLfmFUP3yrIAD",
          },
        };
        fetch(url, options)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Error fetching data");
            }
            return response.json();
          })
          .then((data) => {
            const items = data.items.slice(0, 10);
            items.forEach((item) => {
              const latlng = new naver.maps.LatLng(
                item.point.y,
                item.point.x
              );
              const marker = new naver.maps.Marker({
                position: latlng,
                map: map,
              });
            });
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      }

      getCurrentLocation(getAnimalHospitalData);
    </script>
  </body>
</html>
